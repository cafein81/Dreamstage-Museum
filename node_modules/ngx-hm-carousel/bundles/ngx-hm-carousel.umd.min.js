!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/forms"),require("rxjs"),require("rxjs/operators"),require("resize-observer-polyfill")):"function"==typeof define&&define.amd?define("ngx-hm-carousel",["exports","@angular/core","@angular/common","@angular/forms","rxjs","rxjs/operators","resize-observer-polyfill"],e):e((t=t||self)["ngx-hm-carousel"]={},t.ng.core,t.ng.common,t.ng.forms,t.rxjs,t.rxjs.operators,t["resize-observer-polyfill"])}(this,function(t,e,n,i,r,s,o){"use strict";o=o&&o.hasOwnProperty("default")?o["default"]:o;var a=function(){function t(t,e){this._view=t,this._template=e,this.show=1,this.compelete=!1,this._view.clear()}return Object.defineProperty(t.prototype,"currentI",{set:function(t){if(!this.compelete){var e=t+this.show,n=t-this.show;0!==this.index&&this.index!==this.length-1&&this.index!==e&&this.index!==n&&this.index!==t||(this._view.createEmbeddedView(this._template),this.compelete=!0)}},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){},t.decorators=[{type:e.Directive,args:[{selector:"[ngxHmCarouselDynamic]"}]}],t.ctorParameters=function(){return[{type:e.ViewContainerRef},{type:e.TemplateRef}]},t.propDecorators={index:[{type:e.Input,args:["ngxHmCarouselDynamic"]}],length:[{type:e.Input,args:["ngxHmCarouselDynamicLength"]}],show:[{type:e.Input,args:["ngxHmCarouselDynamicShow"]}],currentI:[{type:e.Input,args:["ngxHmCarouselDynamicIndex"]}]},t}(),u=function(){function t(){}return t.decorators=[{type:e.Directive,args:[{selector:"[ngx-hm-carousel-item]"}]}],t.ctorParameters=function(){return[]},t}();function l(t,e,n){var i;return void 0===n&&(n=200),r.Observable.create(function(e){(i=new o(function(t,n){e.next(i)})).observe(t)}).pipe(s.debounceTime(n),s.tap(function(){e()}),s.finalize(function(){i.unobserve(t),i.disconnect()}))}var h=function(){function t(t,e,n,i,o){var a=this;this.platformId=t,this._document=e,this._renderer=n,this._zone=i,this._cd=o,this.aniTime=400,this.aniClass="transition",this.aniClassAuto=this.aniClass,this.panBoundary=.15,this.align="center",this.notDrag=!1,this.mourseEnable=!1,this.delay=8e3,this.direction="right",this.scrollNum=1,this.isDragMany=!1,this.swipeVelocity=.3,this.breakpoint=[],this.leaveObs$=r.merge(r.fromEvent(this._document,"mouseup"),r.fromEvent(this._document,"touchend")).pipe(s.tap(function(t){a.grabbing=!1,t.stopPropagation(),t.preventDefault()})),this.isFromAuto=!0,this.isAutoNum=!1,this.mouseOnContainer=!1,this.alignDistance=0,this.elmWidth=0,this.infiniteElmRefs=[],this.restart=new r.BehaviorSubject(null),this.speedChange=new r.BehaviorSubject(5e3),this.stopEvent=new r.Subject,this.destroy$=new r.Subject,this._porgressWidth=0,this._currentIndex=0,this._showNum=1,this._autoplay=!1,this._infinite=!1,this._tmpInfinite=!1,this._grabbing=!1,this._disableDrag=!1,this.panCount=0,this.hasInitWriteValue=!1,this.onChange=function(t){},this.onTouched=function(){}}return Object.defineProperty(t.prototype,"disableDrag",{get:function(){return this._disableDrag},set:function(t){this.rootElm&&this._disableDrag!==t&&(t?this.destoryHammer():this.hammer=this.bindHammer()),this._disableDrag=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"infinite",{get:function(){return this._infinite},set:function(t){var e=this;this._infinite=t,this.infiniteElmRefs.forEach(function(t){e.addStyle(t.rootNodes[0],{visibility:e.runLoop?"visible":"hidden"})})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speed",{get:function(){return this.speedChange.value},set:function(t){var e=this;this._zone.runOutsideAngular(function(){e.speedChange.next(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showNum",{get:function(){return this._showNum},set:function(t){"auto"===t?this.isAutoNum=!0:(this._showNum=+t,this.rootElm&&(this.setViewWidth(),this.reSetAlignDistance()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoplay",{get:function(){return this._autoplay},set:function(t){var e=this;n.isPlatformBrowser(this.platformId)&&this.elms&&(this.progressWidth=0,t?this._zone.runOutsideAngular(function(){e.doNextSub$=e.doNext.subscribe()}):this.doNextSub$&&this.doNextSub$.unsubscribe()),this._autoplay=t,t?(this._tmpInfinite=this.infinite,this.infinite=!0):this.infinite=this._tmpInfinite},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentIndex",{get:function(){return this._currentIndex},set:function(t){var e=this;if(this.currentIndex!==t){if(!(this.runLoop||0<=t&&t<=this.itemElms.length-1))return;this._currentIndex=t,this.elms&&(this.autoplay&&!this.isFromAuto&&this._zone.runOutsideAngular(function(){e.stopEvent.next(),e.callRestart()}),this.drawView(this.currentIndex,this.hasInitWriteValue),this.isDragMany&&(this.hasInitWriteValue=!0)),0<=this.currentIndex&&this.currentIndex<=this.itemElms.length-1&&this._zone.run(function(){e.onChange(e.currentIndex),e._cd.detectChanges()})}this.isFromAuto=!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"progressWidth",{get:function(){return this._porgressWidth},set:function(t){this.progressElm!==undefined&&this.autoplay&&(this._porgressWidth=t,this._renderer.setStyle(this.progressContainerElm.nativeElement.children[0],"width",this.progressWidth+"%"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grabbing",{get:function(){return this._grabbing},set:function(t){var e=this;this._grabbing!==t&&this._zone.run(function(){e._grabbing=t,t?e._renderer.addClass(e.containerElm,"grabbing"):(e.panCount=0,e.callRestart(),e._renderer.removeClass(e.containerElm,"grabbing")),e._cd.detectChanges()})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{set:function(t){n.isPlatformBrowser(this.platformId)?this._renderer.setStyle(this.containerElm,"transform","translateX("+t+"px)"):this._renderer.setStyle(this.containerElm,"transform","translateX("+t+"%)")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxRightIndex",{get:function(){var t=0;switch(this.align){case"left":t=0;break;case"center":case"right":t=this.showNum-1}return this.itemElms.length-1-this._showNum+1+t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"runLoop",{get:function(){return this.autoplay||this.infinite},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lengthOne",{get:function(){return 1===this.itemElms.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootElmWidth",{get:function(){return n.isPlatformBrowser(this.platformId)?this.rootElm.getBoundingClientRect().width:100},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"containerElmWidth",{set:function(t){this.setStyle(this.containerElm,"width",t)},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var t=this;this.rootElm=this.container.nativeElement,this.containerElm=this.rootElm.children[0],this.init(),r.forkJoin(this.bindClick(),this.itemElms.changes.pipe(s.tap(function(){t.currentIndex>t.itemElms.length-1&&setTimeout(function(){t.currentIndex=t.itemElms.length-1},0),t.destroy(),t.removeInfiniteElm(),t.init(),t.progressWidth=0}),s.tap(function(){return t._cd.detectChanges()})),l(this.rootElm,function(){return t.containerResize()})).pipe(s.takeUntil(this.destroy$)).subscribe()},t.prototype.ngOnDestroy=function(){this.destroy(),this.destroy$.next(),this.destroy$.unsubscribe()},t.prototype.writeValue=function(t){(t||0===t)&&(this.currentIndex=t,this.hasInitWriteValue=!0)},t.prototype.registerOnChange=function(t){this.onChange=t},t.prototype.registerOnTouched=function(t){this.onTouched=t},t.prototype.init=function(){this.initVariable(),this.setViewWidth(!0),this.reSetAlignDistance(),this.disableDrag||(this.hammer=this.bindHammer()),this.drawView(this.currentIndex,!1),n.isPlatformBrowser(this.platformId)&&this.runLoop&&this.addInfiniteElm()},t.prototype.destroy=function(){this.destoryHammer(),this.autoplay&&this.doNextSub$.unsubscribe()},t.prototype.destoryHammer=function(){this.hammer&&this.hammer.destroy()},t.prototype.addInfiniteElm=function(){for(var t=1;t<=this.showNum;t++){var e=this.infiniteContainer.createEmbeddedView(this.contentContent,{$implicit:this.data[this.itemElms.length-t],index:this.itemElms.length-t});this.addStyle(e.rootNodes[0],{position:"absolute",transform:"translateX(-"+100*t+"%)",visibility:this.runLoop?"visible":"hidden"}),this.setStyle(e.rootNodes[0],"width",this.elmWidth);var n=this.infiniteContainer.createEmbeddedView(this.contentContent,{$implicit:this.data[t-1],index:t-1});this.addStyle(n.rootNodes[0],{position:"absolute",right:0,top:0,transform:"translateX("+100*t+"%)",visibility:this.runLoop?"visible":"hidden"}),this.setStyle(n.rootNodes[0],"width",this.elmWidth),e.detectChanges(),n.detectChanges(),this.infiniteElmRefs.push(e),this.infiniteElmRefs.push(n)}},t.prototype.removeInfiniteElm=function(){this.infiniteElmRefs.forEach(function(t){t.detach(),t.destroy()}),this.infiniteContainer&&this.infiniteContainer.clear(),this.infiniteElmRefs=[]},t.prototype.containerResize=function(){this.setViewWidth(),this.reSetAlignDistance(),"center"!==this.align&&this.showNum>=this.elms.length&&(this.currentIndex=0),this.drawView(this.currentIndex,!1)},t.prototype.initVariable=function(){var t=this;this._zone.runOutsideAngular(function(){t.elms=t.itemElms.toArray().map(function(t){return t.nativeElement});var e=t.restart.asObservable(),n=t.stopEvent.asObservable();t.mourseEnable&&(e=r.merge(e,r.fromEvent(t.containerElm,"mouseleave").pipe(s.filter(function(){return!t.grabbing}),s.tap(function(){return t.mouseOnContainer=!1}))),n=r.merge(n,r.fromEvent(t.containerElm,"mouseover").pipe(s.tap(function(){return t.mouseOnContainer=!0})))),t.doNext=e.pipe(s.switchMap(function(){return t.speedChange}),s.switchMap(function(){return r.timer(t.delay).pipe(s.switchMap(function(){return t.runProgress(20)}),s.tap(function(){t.isFromAuto=!0,"left"===t.direction?t.currentIndex-=t.scrollNum:t.currentIndex+=t.scrollNum}),s.takeUntil(n.pipe(s.tap(function(){return t.progressWidth=0}))))})),t.autoplay&&(t.doNextSub$=t.doNext.subscribe())})},t.prototype.reSetAlignDistance=function(){switch(this.align){case"center":this.alignDistance=(this.rootElmWidth-this.elmWidth)/2;break;case"left":this.alignDistance=0;break;case"right":this.alignDistance=this.rootElmWidth-this.elmWidth}},t.prototype.setViewWidth=function(t){var e=this;this.isAutoNum&&(this._showNum=this.getAutoNum()),this._renderer.addClass(this.containerElm,"grab"),t&&this._renderer.addClass(this.containerElm,"ngx-hm-carousel-display-npwrap"),this.elmWidth=this.rootElmWidth/this._showNum,this._renderer.removeClass(this.containerElm,"ngx-hm-carousel-display-npwrap"),this.containerElmWidth=this.elmWidth*this.elms.length,this._renderer.setStyle(this.containerElm,"position","relative"),this.infiniteElmRefs.forEach(function(t){e.setStyle(t.rootNodes[0],"width",e.elmWidth)}),this.elms.forEach(function(t){e.setStyle(t,"width",e.elmWidth)})},t.prototype.bindHammer=function(){var t=this;return n.isPlatformBrowser(this.platformId)?this._zone.runOutsideAngular(function(){var e=new Hammer.Manager(t.containerElm),n=new Hammer.Pan({direction:Hammer.DIRECTION_HORIZONTAL,threshold:0});return e.add(n),e.on("panleft panright panend pancancel",function(e){if(!t.lengthOne)switch(t.removeContainerTransition(),t.autoplay&&t._zone.runOutsideAngular(function(){t.stopEvent.next()}),e.type){case"panleft":case"panright":if(t.panCount++,t.panCount<2)return;if(t.grabbing=!0,"center"!==t.align&&t.showNum>=t.elms.length)return void t.hammer.stop(!0);if(!t.runLoop&&t.outOfBound(e.type)&&(e.deltaX*=.2),t.notDrag||(t.left=-t.currentIndex*t.elmWidth+t.alignDistance+e.deltaX),!t.isDragMany&&Math.abs(e.deltaX)>.5*t.elmWidth)return e.deltaX>0?t.currentIndex-=t.scrollNum:t.currentIndex+=t.scrollNum,void t.hammer.stop(!0);break;case"pancancel":t.drawView(t.currentIndex);break;case"panend":if(!1!==t.panBoundary&&Math.abs(e.deltaX)>t.elmWidth*t.panBoundary){var n=t.isDragMany?Math.ceil(Math.abs(e.deltaX)/t.elmWidth):t.scrollNum,i=t.currentIndex-n,r=t.currentIndex+n;e.deltaX>0?t.goPrev(i):t.goNext(r);break}e.velocityX<-t.swipeVelocity&&e.distance>10?t.goNext(t.currentIndex+t.scrollNum):e.velocityX>t.swipeVelocity&&e.distance>10?t.goPrev(t.currentIndex-t.scrollNum):t.drawView(t.currentIndex)}}),e}):null},t.prototype.goPrev=function(t){!this.runLoop&&t<0&&(t=0,this.drawView(0)),this.currentIndex=t},t.prototype.goNext=function(t){!this.runLoop&&t>this.maxRightIndex&&(t=this.maxRightIndex,this.drawView(t)),this.currentIndex=t},t.prototype.bindClick=function(){var t=this;return this.btnNext&&this.btnPrev?r.forkJoin(r.fromEvent(this.btnNext.nativeElement,"click").pipe(s.tap(function(){return t.currentIndex++})),r.fromEvent(this.btnPrev.nativeElement,"click").pipe(s.tap(function(){return t.currentIndex--}))):r.of(null)},t.prototype.callRestart=function(){var t=this;!this.autoplay||this.mouseOnContainer||this.grabbing||this._zone.runOutsideAngular(function(){t.restart.next(null)})},t.prototype.drawView=function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=this.isFromAuto),this.elms.length>1?(this.removeContainerTransition(),this.left=-(t*this.elmWidth-this.alignDistance),e&&(n?this._renderer.addClass(this.containerElm,this.aniClassAuto):this._renderer.addClass(this.containerElm,this.aniClass),this.infiniteHandler(t))):this.left=this.alignDistance},t.prototype.removeContainerTransition=function(){this._renderer.removeClass(this.containerElm,this.aniClass),this._renderer.removeClass(this.containerElm,this.aniClassAuto)},t.prototype.infiniteHandler=function(t){var e=this;if(this.runLoop){var n=0;if(n=t<0?-1:n,0!==(n=t>this.itemElms.length-1?1:n)){switch(n){case-1:this._currentIndex=(this.itemElms.length+t)%this.itemElms.length;break;case 1:this._currentIndex=t%this.itemElms.length}var i=this.isFromAuto;this.saveTimeOut&&this.saveTimeOut.unsubscribe(),this.saveTimeOut=r.timer(this.aniTime).pipe(s.switchMap(function(){return e.aniTime===e.speed?(e.removeContainerTransition(),e.left=-(e._currentIndex-n)*e.elmWidth+e.alignDistance,r.timer(50).pipe(s.tap(function(){e.drawView(e.currentIndex,e.hasInitWriteValue,i)}))):(e.drawView(e.currentIndex,!1),r.of(null))}),s.takeUntil(this.stopEvent)).subscribe()}}},t.prototype.outOfBound=function(t){switch(t){case"panleft":return this.currentIndex>=this.maxRightIndex;case"panright":return this.currentIndex<=0}},t.prototype.runProgress=function(t){var e=this;return this._zone.runOutsideAngular(function(){var n=e.speed/t,i=100/e.speed*t;return r.interval(t).pipe(s.tap(function(t){e.progressWidth=t%n*i}),s.bufferCount(Math.round(n),0))})},t.prototype.getAutoNum=function(){var t=this.rootElmWidth;if(this.breakpoint.length>0){var e=this.breakpoint.find(function(e){return e.width>=t});return e?e.number:this.breakpoint[this.breakpoint.length-1].number}return t>300?Math.floor(3+t/200):3},t.prototype.addStyle=function(t,e){var n=this;e&&Object.keys(e).forEach(function(i){var r=e[i];n._renderer.setStyle(t,i,r)})},t.prototype.setStyle=function(t,e,i){n.isPlatformBrowser(this.platformId)?this._renderer.setStyle(t,e,i+"px"):this._renderer.setStyle(t,e,i+"%")},t.decorators=[{type:e.Component,args:[{selector:"ngx-hm-carousel",template:'<div #containerElm class="carousel">\n  \x3c!-- main content --\x3e\n  <ng-content select="[ngx-hm-carousel-container]"></ng-content>\n  \x3c!-- left --\x3e\n  <div #prev *ngIf="contentPrev"\n    class="direction left">\n    <ng-container *ngTemplateOutlet="contentPrev"></ng-container>\n  </div>\n  \x3c!--  right --\x3e\n  <div #next *ngIf="contentNext"\n    class="direction right">\n    <ng-container *ngTemplateOutlet="contentNext"></ng-container>\n  </div>\n  \x3c!-- indicators --\x3e\n  <ul class="indicators" *ngIf="dotElm">\n    <li\n      *ngFor="let dot of itemElms; let i = index;"\n      (click)="currentIndex = i">\n      <ng-container\n        *ngTemplateOutlet="dotElm, context: {\n          $implicit: {\n            index : i,\n            currentIndex : currentIndex\n          }\n        }">\n      </ng-container>\n    </li>\n  </ul>\n  \x3c!-- progress --\x3e\n  <div *ngIf="progressElm && autoplay" #progress>\n    <ng-container\n      *ngTemplateOutlet="progressElm">\n    </ng-container>\n  </div>\n\n  <div class="mask" *ngIf="grabbing">\n    <ng-container *ngIf="leaveObs$ | async"></ng-container>\n  </div>\n</div>\n',providers:[{provide:i.NG_VALUE_ACCESSOR,useExisting:e.forwardRef(function(){return t}),multi:!0}],changeDetection:e.ChangeDetectionStrategy.OnPush,styles:[":host{display:block;height:100%}.ngx-hm-carousel-display-npwrap{display:flex!important;flex-wrap:nowrap!important;flex-direction:row!important;overflow:hidden!important}.carousel{overflow:hidden;position:relative;width:100%;height:100%}.carousel ul.indicators{list-style:none;bottom:1rem;left:0;margin:0;padding:0;position:absolute;text-align:center;width:100%}.carousel ul.indicators li{cursor:pointer;display:inline-block;position:relative;padding:.5rem}.carousel .direction{position:absolute;height:100%;cursor:pointer;display:flex;align-items:center;justify-content:center;top:0}.carousel .direction.left{left:0}.carousel .direction.right{position:absolute;right:0}.grab{cursor:-webkit-grab;cursor:grab}.grabbing{cursor:-webkit-grabbing;cursor:grabbing}.mask{position:absolute;left:0;top:0;right:0;bottom:0}"]}]}],t.ctorParameters=function(){return[{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]},{type:undefined,decorators:[{type:e.Inject,args:[n.DOCUMENT]}]},{type:e.Renderer2},{type:e.NgZone},{type:e.ChangeDetectorRef}]},t.propDecorators={container:[{type:e.ViewChild,args:["containerElm",{"static":!1}]}],btnPrev:[{type:e.ViewChild,args:["prev",{"static":!1}]}],btnNext:[{type:e.ViewChild,args:["next",{"static":!1}]}],progressContainerElm:[{type:e.ViewChild,args:["progress",{"static":!1}]}],itemElms:[{type:e.ContentChildren,args:[u,{read:e.ElementRef}]}],contentPrev:[{type:e.ContentChild,args:["carouselPrev",{"static":!1}]}],contentNext:[{type:e.ContentChild,args:["carouselNext",{"static":!1}]}],dotElm:[{type:e.ContentChild,args:["carouselDot",{"static":!1}]}],progressElm:[{type:e.ContentChild,args:["carouselProgress",{"static":!1}]}],infiniteContainer:[{type:e.ContentChild,args:["infiniteContainer",{"static":!1,read:e.ViewContainerRef}]}],contentContent:[{type:e.ContentChild,args:["carouselContent",{"static":!1}]}],data:[{type:e.Input}],aniTime:[{type:e.Input}],aniClass:[{type:e.Input}],aniClassAuto:[{type:e.Input}],swipe:[{type:e.Input}],panBoundary:[{type:e.Input,args:["pan-boundary"]}],align:[{type:e.Input}],notDrag:[{type:e.Input,args:["not-follow-pan"]}],mourseEnable:[{type:e.Input,args:["mourse-enable"]}],delay:[{type:e.Input,args:["between-delay"]}],direction:[{type:e.Input,args:["autoplay-direction"]}],scrollNum:[{type:e.Input,args:["scroll-num"]}],isDragMany:[{type:e.Input,args:["drag-many"]}],swipeVelocity:[{type:e.Input,args:["swipe-velocity"]}],breakpoint:[{type:e.Input}],disableDrag:[{type:e.Input,args:["disable-drag"]}],infinite:[{type:e.Input,args:["infinite"]}],speed:[{type:e.Input,args:["autoplay-speed"]}],showNum:[{type:e.Input,args:["show-num"]}],autoplay:[{type:e.Input,args:["autoplay"]}]},t}(),c=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule,i.FormsModule],declarations:[h,a,u],exports:[h,a,u]}]}],t}();t.NgxHmCarouselComponent=h,t.NgxHmCarouselDynamicDirective=a,t.NgxHmCarouselModule=c,t.resizeObservable=l,t.ɵa=u,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-hm-carousel.umd.min.js.map